{
  "gitSyncId": "68a1678a8fc1056ba0ac565c_04d7edd3-81ec-4725-b2f2-c7707653d3a5",
  "id": "Processing Withdrawal_qy_pullPointFromAccount3",
  "pluginId": "mysql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "-- 1) Jika point cukup: kurangi point + ubah transaksi Verify jadi Success\nUPDATE wp_users u\nJOIN (\n\tSELECT user_id, SUM(amount) AS total_amount\n\tFROM transactions_wd\n\tWHERE status = 'Verify'\n\tGROUP BY user_id\n) t ON u.ID = t.user_id\nJOIN transactions_wd tw ON tw.user_id = u.ID AND tw.status = 'Verify'\nSET u.point = u.point - t.total_amount,\n    tw.status = 'Success'\nWHERE u.point >= t.total_amount;\n\n-- 2) Jika point tidak cukup: ubah transaksi Verify jadi Insufficient\nUPDATE transactions_wd tw\nJOIN (\n\tSELECT u.ID AS user_id\n\tFROM wp_users u\n\tJOIN (\n\t\tSELECT user_id, SUM(amount) AS total_amount\n\t\tFROM transactions_wd\n\t\tWHERE status = 'Verify'\n\t\tGROUP BY user_id\n\t) t ON u.ID = t.user_id\n\tWHERE u.point < t.total_amount\n) x ON tw.user_id = x.user_id\nSET tw.status = 'Insufficient', tw.voucher = 'Insufficient'\nWHERE tw.status = 'Verify';\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "pilahsampah_db",
      "isAutoGenerated": false,
      "name": "pilahsampah_db",
      "pluginId": "mysql-plugin"
    },
    "dynamicBindingPathList": [],
    "name": "qy_pullPointFromAccount3",
    "pageId": "Processing Withdrawal",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}