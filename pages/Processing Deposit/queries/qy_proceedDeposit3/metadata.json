{
  "gitSyncId": "68a1678a8fc1056ba0ac565c_23701cc0-ee99-45b1-bc06-980a0e618b35",
  "id": "Processing Deposit_qy_proceedDeposit3",
  "pluginId": "mysql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "START TRANSACTION;\n\n-- 1. Masukkan data yang cocok ke transactions_success \n--    lalu set inject = '1' di tabel tujuan\nINSERT INTO transactions_success (user_id, user_name, transactioncode, transactiondate, amount, status, inputdate)\nSELECT t.user_id, t.user_name, t.transactioncode, t.transactiondate, s.saldo, 'Success', t.inputdate\nFROM transactions t\nJOIN savedatabaru s\n  ON t.transactioncode = s.transactioncode \n AND t.transactiondate = s.transactiondate\nWHERE NOT EXISTS (\n\tSELECT 1 \n\tFROM transactions_success ts\n\tWHERE ts.transactioncode = t.transactioncode\n\tAND ts.transactiondate = t.transactiondate\n);\n\n-- 2. Masukkan data ke transactions_invalid\n--    Status = 'used' jika sudah ada di transactions_success\n--    Status = 'Invalid' jika tidak match di savedatabaru\nINSERT INTO transactions_invalid (user_id, user_name, transactioncode, transactiondate, status, inputdate)\nSELECT \n    t.user_id,\n    t.user_name,\n    t.transactioncode,\n    t.transactiondate,\n    CASE\n        WHEN EXISTS (\n\t\t\t\t\tSELECT 1 \n\t\t\t\t\tFROM transactions_success ts\n\t\t\t\t\tWHERE ts.transactioncode = t.transactioncode\n\t\t\t\t\tAND ts.transactiondate = t.transactiondate\n\t\t\t\t) THEN 'used'\n        ELSE 'Invalid'\n    END AS status,\n    t.inputdate\nFROM transactions t\nWHERE NOT EXISTS (\n\tSELECT 1 \n\tFROM savedatabaru s\n\tWHERE s.transactioncode = t.transactioncode\n\tAND s.transactiondate = t.transactiondate\n)\n   OR EXISTS (\n\t\t SELECT 1 \n\t\t FROM transactions_success ts\n\t\t WHERE ts.transactioncode = t.transactioncode\n\t\t AND ts.transactiondate = t.transactiondate\n\t );\n\n-- 3. Hapus data yang cocok dari savedatabaru\nDELETE FROM savedatabaru\nWHERE EXISTS (\n\tSELECT 1\n\tFROM transactions t\n\tWHERE t.transactioncode = savedatabaru.transactioncode\n\tAND t.transactiondate = savedatabaru.transactiondate\n);\n\n-- 4. Hapus data yang cocok dari transactions\nDELETE FROM transactions\nWHERE EXISTS (\n\tSELECT 1\n\tFROM savedatabaru s\n\tWHERE s.transactioncode = transactions.transactioncode\n\tAND s.transactiondate = transactions.transactiondate\n);\n\n-- 5. Hapus data yang tidak cocok dari transactions\nDELETE FROM transactions\nWHERE NOT EXISTS (\n\tSELECT 1\n\tFROM savedatabaru s\n\tWHERE s.transactioncode = transactions.transactioncode\n\tAND s.transactiondate = transactions.transactiondate\n);\n\nCOMMIT;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "pilahsampah_db",
      "isAutoGenerated": false,
      "name": "pilahsampah_db",
      "pluginId": "mysql-plugin"
    },
    "dynamicBindingPathList": [],
    "name": "qy_proceedDeposit3",
    "pageId": "Processing Deposit",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": true
  }
}